<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Chess vs Stockfish</title>
<style>
body{margin:0;font-family:sans-serif;background:#f0f0f5;color:#333;}
#game-container{display:flex;gap:20px;padding:20px;justify-content:center;}
#board-container{display:flex;flex-direction:column;align-items:center;}
#board{display:grid;grid-template-columns:repeat(8,60px);grid-template-rows:repeat(8,60px);border:2px solid #333;}
.square{width:60px;height:60px;display:flex;align-items:center;justify-content:center;font-size:36px;cursor:pointer;user-select:none;}
.white{background:#eee;} .black{background:#666;color:white;}
.highlight{background:#ffd700 !important;}
#controls{margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;}
button,input[type=range]{padding:6px 10px;border-radius:4px;font-size:14px;}
#log-container{display:flex;flex-direction:column;gap:10px;width:200px;}
#log,#history{background:white;border:1px solid #ccc;height:200px;overflow-y:auto;padding:8px;font-family:monospace;font-size:14px;}
#settings-tab{background:white;border:1px solid #ccc;padding:10px;display:none;position:absolute;top:20px;right:20px;width:250px;}
#settings-tab label{display:block;margin-top:10px;font-size:14px;}
#promotion-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;}
#promotion-modal .choices{background:white;padding:20px;border-radius:6px;display:flex;gap:10px;}
</style>
</head>
<body>

<div id="game-container">
  <div id="board-container">
    <div id="board"></div>
    <div id="controls">
      <button id="resetBtn">Reset</button>
      <button id="undoBtn">Undo</button>
      <button id="settingsBtn">Settings</button>
      <label>Difficulty: <span id="difficultyLabel">800</span></label>
      <input type="range" id="difficultySlider" min="800" max="2500" step="100" value="800">
    </div>
  </div>
  <div id="log-container">
    <div>
      <h2>Engine Log</h2>
      <div id="log"></div>
    </div>
    <div>
      <h2>Move History</h2>
      <div id="history"></div>
    </div>
  </div>
</div>

<div id="settings-tab">
  <h3>Settings</h3>
  <label>Promotion Mode:
    <select id="promotionMode">
      <option value="popup">Pop-up</option>
      <option value="queen">Auto-Queen</option>
    </select>
  </label>
  <label>Show Legal Moves:
    <input type="checkbox" id="showLegal" checked>
  </label>
</div>

<div id="promotion-modal">
  <div class="choices" id="promotionChoices"></div>
</div>

<script>
const boardEl=document.getElementById("board");
const logEl=document.getElementById("log");
const historyEl=document.getElementById("history");
const promotionModal=document.getElementById("promotion-modal");
const promotionChoices=document.getElementById("promotionChoices");

let board=[], turn='w', selected=null, moveHistory=[];
let promotionMode='popup', showLegal=true;

const unicodePieces={r:'♜',n:'♞',b:'♝',q:'♛',k:'♚',p:'♟',R:'♖',N:'♘',B:'♗',Q:'♕',K:'♔',P:'♙'};

// Initialize board
function initBoard(){
  board=[
    ['r','n','b','q','k','b','n','r'],
    ['p','p','p','p','p','p','p','p'],
    ['','','','','','','',''],
    ['','','','','','','',''],
    ['','','','','','','',''],
    ['','','','','','','',''],
    ['P','P','P','P','P','P','P','P'],
    ['R','N','B','Q','K','B','N','R']
  ];
  turn='w';
  selected=null;
  moveHistory=[];
  renderBoard();
  historyEl.textContent='';
}
initBoard();

function renderBoard(){
  boardEl.innerHTML='';
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      const sq=document.createElement('div');
      sq.className='square '+((r+c)%2===0?'white':'black');
      sq.dataset.row=r;
      sq.dataset.col=c;
      sq.textContent=unicodePieces[board[r][c]]||'';
      sq.addEventListener('click',onSquareClick);
      boardEl.appendChild(sq);
    }
  }
}

function onSquareClick(e){
  const r=parseInt(e.currentTarget.dataset.row);
  const c=parseInt(e.currentTarget.dataset.col);
  const piece=board[r][c];
  if(selected){
    makeMove(selected[0],selected[1],r,c);
    selected=null;
    renderBoard();
  }else if(piece && ((turn==='w' && piece===piece.toUpperCase())||(turn==='b' && piece===piece.toLowerCase()))){
    selected=[r,c];
  }
}

function makeMove(r1,c1,r2,c2){
  const piece=board[r1][c1];
  const target=board[r2][c2];
  board[r2][c2]=piece;
  board[r1][c1]='';
  moveHistory.push({r1,c1,r2,c2,piece,target});
  turn=(turn==='w')?'b':'w';
  addHistory(`${piece}${r1}${c1}->${r2}${c2}`);
}

// Undo
document.getElementById("undoBtn").addEventListener("click",()=>{
  if(!moveHistory.length) return;
  const last=moveHistory.pop();
  board[last.r1][last.c1]=last.piece;
  board[last.r2][last.c2]=last.target;
  turn=(turn==='w')?'b':'w';
  renderBoard();
  historyEl.textContent=moveHistory.map(m=>`${m.piece}${m.r1}${m.c1}->${m.r2}${m.c2}`).join(' ');
});

// Reset
document.getElementById("resetBtn").addEventListener("click", initBoard);

// Settings
const settingsTab=document.getElementById("settings-tab");
document.getElementById("settingsBtn").addEventListener("click",()=>settingsTab.style.display=(settingsTab.style.display==='none'?'block':'none'));
document.getElementById("promotionMode").addEventListener("change",(e)=>promotionMode=e.target.value);
document.getElementById("showLegal").addEventListener("change",(e)=>showLegal=e.target.checked);

function addHistory(move){ historyEl.textContent+=move+' '; historyEl.scrollTop=historyEl.scrollHeight;}

</script>
</body>
</html>
